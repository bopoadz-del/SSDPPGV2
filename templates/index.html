<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MSSDPPG Live Simulator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
  </head>
  <body>
    <header>
      <h1>MSSDPPG Live Simulator</h1>
      <p>Interactive simulator and finance dashboard for multi-module systems.</p>
    </header>

    <nav class="tabs">
      <button class="tab-button active" data-tab="physics">Physics</button>
      <button class="tab-button" data-tab="wind">Wind Resource</button>
      <button class="tab-button" data-tab="power">Power Curve</button>
      <button class="tab-button" data-tab="economics">AEP & LCOE</button>
      <button class="tab-button" data-tab="smoothing">Smoothing</button>
      <button class="tab-button" data-tab="site">Whole Site</button>
    </nav>

    <main>
      <section id="physics" class="tab-content active">
        <h2>Physics Inputs</h2>
        <div class="grid">
          <div class="card">
            <h3>Aero Model</h3>
            <label>Energy model
              <select id="energyModel">
                <option value="aero">Aero Cp model</option>
                <option value="sim">Sim-based power</option>
              </select>
            </label>
            <label>Swept area (m²) <input id="sweptArea" type="number" step="1" /></label>
            <label>Cp (0-0.59) <input id="cp" type="number" step="0.01" /></label>
            <label>Air density (rho) <input id="rho" type="number" step="0.01" /></label>
            <label>Drivetrain efficiency <input id="drivetrainEff" type="number" step="0.01" /></label>
            <label>Availability <input id="availability" type="number" step="0.01" /></label>
            <label>Inverter rating (kW) <input id="inverterRating" type="number" step="1" /></label>
          </div>
          <div class="card">
            <h3>Advanced DP Parameters</h3>
            <label>L1 (m) <input id="l1" type="number" step="0.1" /></label>
            <label>L2 (m) <input id="l2" type="number" step="0.1" /></label>
            <label>m upper arm (kg) <input id="mUpper" type="number" step="1" /></label>
            <label>m middle (kg) <input id="mMiddle" type="number" step="1" /></label>
            <label>m lower (kg) <input id="mLower" type="number" step="1" /></label>
            <label>m tip (kg) <input id="mTip" type="number" step="1" /></label>
            <label># pendulums <input id="nPendulums" type="number" step="1" /></label>
          </div>
          <div class="card">
            <h3>Quick Simulation</h3>
            <label>Wind speed (m/s) <input id="simWind" type="number" step="0.1" value="8" /></label>
            <button id="runSim">Run Simulation</button>
            <div id="simPlot" class="plot"></div>
          </div>
        </div>
      </section>

      <section id="wind" class="tab-content">
        <h2>Wind Resource</h2>
        <div class="grid">
          <div class="card">
            <h3>Weibull Inputs</h3>
            <label>k <input id="weibullK" type="number" step="0.1" /></label>
            <label>c <input id="weibullC" type="number" step="0.1" /></label>
            <label>Preset
              <select id="weibullPreset"></select>
            </label>
            <button id="applyPreset">Apply Preset</button>
          </div>
          <div class="card">
            <h3>Histogram Upload</h3>
            <textarea id="histogramCsv" rows="6" placeholder="speed_mps,prob\n4,0.05\n5,0.1"></textarea>
            <button id="parseHistogram">Parse Histogram</button>
            <pre id="histogramPreview"></pre>
          </div>
        </div>
      </section>

      <section id="power" class="tab-content">
        <h2>Power Curve</h2>
        <button id="generateCurve">Generate Power Curve</button>
        <button id="exportCurveCsv">Export CSV</button>
        <div id="curvePlot" class="plot"></div>
      </section>

      <section id="economics" class="tab-content">
        <h2>AEP & LCOE</h2>
        <div class="grid">
          <div class="card">
            <h3>CapEx Inputs</h3>
            <label>Mechanical (USD) <input id="capexMech" type="number" step="1000" /></label>
            <label>Electrical (USD) <input id="capexElec" type="number" step="1000" /></label>
            <label>Civil/BOS (USD) <input id="capexCivil" type="number" step="1000" /></label>
            <label>Soft costs (USD) <input id="capexSoft" type="number" step="1000" /></label>
            <label>Contingency (%) <input id="capexCont" type="number" step="0.1" /></label>
          </div>
          <div class="card">
            <h3>Finance Inputs</h3>
            <label>Project life (years) <input id="projectLife" type="number" step="1" /></label>
            <label>WACC (%) <input id="wacc" type="number" step="0.1" /></label>
            <label>Fixed O&M (USD/year) <input id="fixedOm" type="number" step="100" /></label>
            <label>Variable O&M (USD/kWh) <input id="variableOm" type="number" step="0.0001" /></label>
          </div>
          <div class="card">
            <h3>Actions</h3>
            <button id="calcAep">Calculate AEP</button>
            <button id="calcLcoe">Calculate LCOE</button>
            <button id="exportLcoeCsv">Export LCOE CSV</button>
            <div id="aepResult"></div>
          </div>
        </div>
        <div class="table-wrap">
          <h3>LCOE Table</h3>
          <table id="lcoeTable"></table>
        </div>
        <div class="table-wrap">
          <h3>Investor Scenarios</h3>
          <table id="investorTable"></table>
        </div>
      </section>

      <section id="smoothing" class="tab-content">
        <h2>Phase Offsets & Curtailment</h2>
        <div class="grid">
          <div class="card">
            <label>Number of modules <input id="smoothModules" type="number" step="1" /></label>
            <label>Phase offset (deg) <input id="phaseOffset" type="number" step="1" /></label>
            <label>Inverter rating (kW) <input id="smoothInverter" type="number" step="1" /></label>
            <label>Base power (kW) <input id="smoothBasePower" type="number" step="1" /></label>
            <button id="calcSmoothing">Calculate smoothing</button>
          </div>
          <div class="card">
            <div id="smoothingPlot" class="plot"></div>
          </div>
        </div>
      </section>

      <section id="site" class="tab-content">
        <h2>Whole-Site Rollup</h2>
        <div class="grid">
          <div class="card">
            <label>Modules count <input id="siteModules" type="number" step="1" /></label>
            <label>Module spacing (m²) <input id="moduleSpacing" type="number" step="1" /></label>
            <label>Density (modules/ha) <input id="moduleDensity" type="number" step="0.1" /></label>
            <label>Land cost (USD/m²) <input id="landCost" type="number" step="0.1" /></label>
            <button id="calcSite">Calculate site rollup</button>
          </div>
          <div class="card">
            <div id="siteResults"></div>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <small>Render-ready: gunicorn + Flask · Plotly for client-side exports</small>
    </footer>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
  </body>
</html>
